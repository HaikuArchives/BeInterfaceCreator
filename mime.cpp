#include "proto.h"

char bbcbuilder_exec[] = "application/x-vnd.rgb.Bic";
char bbcbuilder_mime[] = "application/x-vnd.rgb.BicProject";

const unsigned char kLargeIconBits [] = {
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0xbb,
	0xbb,0xbb,0xbb,0x3f,0x3f,0x3f,0x3f,0x3f,0xbd,0xbd,0xbd,0xbd,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0xbb,0x5a,0x5a,0x5a,
	0x5a,0x5a,0x5a,0xbb,0xbb,0xbb,0xbd,0xbd,0xf8,0xf8,0xd9,0xd9,0xbd,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0x5a,0x5a,0x5a,0x5a,0xfe,0xfe,
	0xfe,0xfe,0xfe,0x5a,0x5a,0xbd,0xf8,0xf8,0xf8,0xd9,0xd9,0xd9,0xbd,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0x5a,0x5a,0x5a,0xfe,0xfe,0xfe,0xfe,0xfe,
	0xfe,0xfe,0xfe,0xd9,0xbd,0xf8,0xf8,0xf8,0xd9,0xd9,0xd9,0xbd,0xbd,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0x5a,0x5a,0xfe,0xd9,0xfe,0xfe,0xfe,0xfe,0xfe,
	0xfe,0xfe,0xd9,0xbd,0xf8,0xf8,0xf8,0xd9,0xd9,0xd9,0xbd,0xbd,0xbd,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0x5a,0xfe,0xd9,0xfe,0xd9,0xfe,0xfe,0xfe,0xfe,
	0xfe,0xd9,0xbd,0xf8,0xf8,0xf8,0xd9,0xd9,0xbd,0xbd,0xbd,0xbd,0x10,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0x5a,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,
	0xd9,0xbd,0xf8,0xf8,0xf8,0xd9,0xd9,0xbd,0xbd,0xbd,0xbd,0x9c,0x10,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0xbb,0x5a,0x5a,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,
	0xbd,0xf8,0xf8,0xf8,0xd9,0xd9,0xbd,0xbd,0xbd,0xbd,0x9c,0x9c,0x9c,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0xbb,0xbb,0x5a,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xf8,
	0xbd,0xf8,0xf8,0xd9,0xd9,0xbd,0xbd,0xbd,0x10,0x10,0x10,0x9c,0x9c,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0xbb,0x5a,0x5a,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xf8,0xbd,
	0xf8,0xf8,0xd9,0xd9,0xbd,0xbd,0xbd,0x10,0x10,0x10,0x10,0x10,0x5a,0xbb,0x3f,0x3f,
	0x3f,0x3f,0x3f,0xbb,0x5a,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xf8,0xbd,0xf8,
	0xf8,0xd9,0xd9,0xbd,0xbd,0xbd,0x10,0x10,0x10,0x10,0x10,0xfe,0x5a,0xbb,0x3f,0x3f,
	0x3f,0x3f,0xbb,0x5a,0x5a,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xbd,0xf8,0xf8,
	0xd9,0xd9,0xbd,0xbd,0xbd,0x10,0x10,0x10,0x10,0xd9,0xfe,0xd9,0xfe,0xbb,0x3f,0x3f,
	0x3f,0x3f,0xbb,0x5a,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xbd,0xf8,0xf8,0xd9,
	0xbd,0xbd,0xbd,0xbd,0x10,0x10,0x10,0x10,0xd9,0xfe,0xd9,0xfe,0xd9,0x5a,0xbb,0x3f,
	0x3f,0x3f,0xbb,0x5a,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xbd,0xf8,0xf8,0xd9,0xbd,
	0xbd,0xbd,0xbd,0x10,0x10,0x10,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0x5a,0xbb,0x3f,
	0x3f,0x3f,0xbb,0x5a,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xbd,0xbd,0xbd,0xd9,0xbd,0xbd,
	0xbd,0xbd,0x10,0x10,0x10,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0x5a,0xbb,0x3f,
	0x3f,0x13,0x13,0x13,0xfe,0xd9,0xfe,0xd9,0x13,0x13,0x3f,0x16,0xbd,0xbd,0xbd,0xbd,
	0x10,0x10,0x10,0x10,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0x5a,0xbb,0x3f,
	0x13,0x3f,0x3f,0x3f,0x13,0x13,0x13,0x13,0x3f,0x3f,0x3f,0x3f,0x16,0xbd,0xbd,0x10,
	0x10,0x10,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0x5a,0xbb,0x3f,
	0x13,0x19,0x18,0x3f,0x3f,0x3f,0x1c,0x1c,0x3f,0x3f,0x3f,0x3f,0x3f,0xbd,0x10,0x10,
	0x10,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0xd9,0xfe,0x5a,0xbb,0x3f,
	0x13,0x18,0x1b,0x19,0x3f,0x3f,0x3f,0x1c,0x1c,0x3f,0x3f,0x3f,0x16,0x15,0x10,0x10,
	0xd9,0xfe,0xd9,0xfe,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xfe,0xd9,0x5a,0xbb,0x3f,
	0x13,0x1b,0x1b,0x1b,0x19,0x19,0x3f,0x3f,0x1c,0x1c,0x3f,0x3f,0x16,0x15,0x10,0xd9,
	0xfe,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0x5a,0xbb,0x3f,0x3f,
	0x85,0x15,0x18,0x1b,0x1b,0x1b,0x19,0x3f,0x3f,0x1c,0x1c,0x1c,0x3f,0x15,0x10,0xfe,
	0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0x5a,0xbb,0x3f,0x3f,
	0x85,0x85,0x15,0x15,0x1b,0x1b,0x1b,0x19,0x19,0x3f,0x3f,0x1c,0x1c,0x3f,0x10,0xd9,
	0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0x5a,0xbb,0xbb,0x3f,0x3f,
	0x3f,0x85,0x85,0x85,0x15,0x18,0x1b,0x1b,0x1b,0x19,0x3f,0x3f,0x3f,0x1c,0x10,0xd9,
	0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0x5a,0xbb,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x85,0x85,0x15,0x15,0x1b,0x1b,0x1b,0x19,0x19,0x3f,0x3f,0x3f,0x10,
	0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0x5a,0xbb,0xbb,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x85,0x85,0x85,0x15,0x15,0x1b,0x1b,0x1b,0x19,0x3f,0x3f,0x3f,
	0x10,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0x5a,0xbb,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0x85,0x85,0x85,0x15,0x1b,0x1b,0x1b,0x19,0x19,0x0f,
	0x0f,0x10,0x10,0xd9,0xd9,0xd9,0xd9,0xd9,0xd9,0x5a,0xbb,0x5a,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0x85,0x85,0x15,0x15,0x1b,0x1b,0x1b,0x15,
	0x15,0x10,0x10,0xd9,0xd9,0xd9,0xd9,0x5a,0x5a,0xbb,0x5a,0x3f,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0x85,0x85,0x85,0x15,0x18,0x1b,0x15,
	0x15,0xa5,0x10,0xd9,0xd9,0xd9,0x5a,0xbb,0xbb,0x5a,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0x85,0x85,0x85,0x15,0x15,
	0xa5,0xa5,0x10,0x5a,0x5a,0x5a,0xbb,0xbb,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0xbb,0x85,0x85,0xa5,
	0xa5,0xa5,0x10,0xbb,0xbb,0xbb,0x5a,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0xbb,0xbb,
	0xbb,0xbb,0xbb,0xbb,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f
};

const unsigned char kSmallIconBits [] = {
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0xbb,0x5a,0x5a,0x5a,0xbd,0xf8,0xd9,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0xbb,0x5a,0xfe,0xfe,0xfe,0xbd,0xf8,0xd9,0xd9,0xbd,0x3f,0x3f,
	0x3f,0x3f,0x3f,0xbb,0xfe,0xfe,0xfe,0xfe,0xbd,0xf8,0xd9,0xbd,0xbd,0x9c,0x3f,0x3f,
	0x3f,0x3f,0xbb,0xfe,0xfe,0xfe,0xfe,0xf8,0xf8,0xd9,0xbd,0xbd,0x10,0x9c,0x3f,0x3f,
	0x3f,0x3f,0x5a,0xfe,0xfe,0xfe,0xf8,0xf8,0xd9,0xbd,0xbd,0x10,0x10,0xfe,0xbb,0x3f,
	0x3f,0xbb,0xfe,0xfe,0xfe,0xfe,0xf8,0xd9,0xbd,0xbd,0x10,0x10,0xfe,0xfe,0xbb,0x3f,
	0x3f,0x5a,0xfe,0xfe,0xfe,0xbd,0xd9,0xbd,0xbd,0x10,0x10,0xfe,0xfe,0xfe,0xbb,0x3f,
	0x3f,0x5a,0xfe,0xf8,0xfe,0x15,0xbd,0x10,0x10,0x10,0xfe,0xfe,0xfe,0xfe,0xbb,0x3f,
	0x3f,0x9c,0xf8,0xd9,0xbd,0xfe,0x15,0x10,0x10,0xfe,0xfe,0xfe,0xfe,0xfe,0xbb,0x3f,
	0x3f,0x9c,0xf8,0xd9,0xbd,0x10,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0x5a,0xbb,0x3f,
	0x3f,0x5a,0x15,0xbd,0x10,0x10,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0xbb,0x3f,0x3f,
	0x3f,0x3f,0xbb,0x15,0x10,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0x5a,0xbb,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x5a,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0x5a,0xbb,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0xbb,0x5a,0xfe,0xfe,0xfe,0xfe,0xbb,0xbb,0x3f,0x3f,0x3f,0x3f,
	0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x5a,0xbb,0xbb,0xbb,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f
};


void
check_isinstalled_mime(void)
{
	BMimeType *xt;

	BBitmap			large_icon(BRect(0, 0, B_LARGE_ICON - 1, B_LARGE_ICON - 1), B_COLOR_8_BIT);
	BBitmap			mini_icon(BRect(0, 0, B_MINI_ICON - 1, B_MINI_ICON - 1), B_COLOR_8_BIT);

	BMimeType 		mime;
	
	mime.SetTo(&bbcbuilder_mime[0]);

	if (!mime.IsInstalled())
	{
		mime.Install();

		large_icon.SetBits(kLargeIconBits, large_icon.BitsLength(), 0, B_COLOR_8_BIT);
		mini_icon.SetBits(kSmallIconBits, mini_icon.BitsLength(), 0, B_COLOR_8_BIT);

		mime.SetShortDescription("Bic Project");
		mime.SetLongDescription("Bic Project (c) 2001 Devulder jpaul email:rgb@free.fr");
		mime.SetIcon(&large_icon, B_LARGE_ICON);
		mime.SetIcon(&mini_icon, B_MINI_ICON);
		mime.SetPreferredApp(&bbcbuilder_exec[0]);
	}

	if	(xt = new BMimeType(&bbcbuilder_exec[0]))
	{
		if	(xt->InitCheck() == B_OK)
		{
			if (!xt->IsInstalled())
			{
				if (xt->Install() == B_OK)
				{
					;
				}
			}
		}
		
		delete xt;
	}
}

/*

void
save_icon(BFile *fi)
{
	BNodeInfo *inf;

	if (inf = new BNodeInfo(fi))
	{
		if (inf->InitCheck() == B_OK)
		{
		}

		delete inf;
	}
}
*/

void
set_mimefile(char *file,char *mime)
{
	BNode			*node;
	BNodeInfo		*binfo;	
	BEntry ent(file,true);

	if (node = new BNode(&ent))
	{
		if (node->InitCheck() == B_NO_ERROR)
		{
			if	(binfo = new BNodeInfo(node))
			{
				if (binfo->InitCheck() == B_NO_ERROR)
				{
					app_info inf;

					BMimeType kk("application/x-vnd.rgb.Bic");

					BBitmap	b1(BRect(0, 0, B_LARGE_ICON - 1, B_LARGE_ICON - 1),B_COLOR_8_BIT);
					BBitmap	b0(BRect(0, 0, B_MINI_ICON - 1, B_MINI_ICON - 1), B_COLOR_8_BIT);

					be_roster->GetRunningAppInfo(be_app->Team(),&inf);

					kk.GetIcon(&b0,B_MINI_ICON);
					kk.GetIcon(&b1,B_LARGE_ICON);

					binfo->SetIcon(&b0,B_MINI_ICON);
					binfo->SetIcon(&b1,B_LARGE_ICON);

					binfo->SetAppHint(&inf.ref);

					binfo->SetType(&bbcbuilder_mime[0]);

					binfo->SetPreferredApp(&bbcbuilder_exec[0]);
				}

				delete binfo;
			}
		}

		delete node;
	}			
}

void
set_sourcecode(char *file)
{
	BNode			*node;
	BNodeInfo		*binfo;	
	BEntry ent(file,true);

	if (node = new BNode(&ent))
	{
		if (node->InitCheck() == B_NO_ERROR)
		{
			if	(binfo = new BNodeInfo(node))
			{
				if (binfo->InitCheck() == B_NO_ERROR)
				{
					binfo->SetType("text/x-source-code");
				}

				delete binfo;
			}
		}

		delete node;
	}			
}
